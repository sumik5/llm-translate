<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM翻訳ツール - Markdown/EPUB/PDF対応</title>
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- JSZip for EPUB parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- PDF.js for PDF parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';</script>
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markdown.min.js"></script>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="translator.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-title">
                    <h1>LLM Translation</h1>
                </div>
                <div class="header-controls">
                    <button id="translateBtn" class="btn btn-default">
                        <span class="btn-text">翻訳する</span>
                        <span class="spinner"></span>
                    </button>
                    <button id="saveHtmlBtn" class="btn btn-secondary">
                        保存
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Alert Messages -->
            <div class="alert alert-error" id="errorMessage"></div>

            <!-- Controls Bar -->
            <div class="controls-bar">
                <div class="control-group">
                    <label class="label" for="targetLang">翻訳先言語</label>
                    <select id="targetLang" class="select">
                        <option value="日本語" selected>日本語</option>
                        <option value="英語">英語</option>
                        <option value="中国語">中国語</option>
                        <option value="韓国語">韓国語</option>
                        <option value="スペイン語">スペイン語</option>
                        <option value="フランス語">フランス語</option>
                        <option value="ドイツ語">ドイツ語</option>
                        <option value="ロシア語">ロシア語</option>
                        <option value="ポルトガル語">ポルトガル語</option>
                        <option value="イタリア語">イタリア語</option>
                    </select>
                </div>

                <div class="control-group">
                    <label class="label" for="fontSelect">フォント</label>
                    <select id="fontSelect" class="select">
                        <option value="default">デフォルト</option>
                        <option value="noto-sans-jp">Noto Sans JP</option>
                        <option value="noto-serif-jp">Noto Serif JP</option>
                        <option value="sawarabi-mincho">さわらび明朝</option>
                        <option value="sawarabi-gothic">さわらびゴシック</option>
                        <option value="m-plus-1p">M PLUS 1p</option>
                    </select>
                </div>

                <div class="control-group">
                    <label class="label" for="apiUrl">API URL</label>
                    <input type="text" id="apiUrl" class="input" value="http://127.0.0.1:1234" style="width: 15rem;">
                </div>

                <div class="control-group">
                    <label class="label" for="modelName">モデル</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <select id="modelName" class="select" style="min-width: 12rem;">
                            <option value="">読み込み中...</option>
                        </select>
                        <button id="refreshModels" class="btn btn-outline btn-icon" title="モデル一覧を更新">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 2v6h-6"></path>
                                <path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path>
                                <path d="M3 22v-6h6"></path>
                                <path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="control-group">
                    <label class="label" for="chunkSize">チャンクサイズ</label>
                    <div style="display: flex; align-items: center; gap: 0.25rem;">
                        <input type="text" id="chunkSize" class="input" value="1000" style="width: 7rem;" inputmode="numeric" pattern="[0-9]*">
                        <button id="chunkSizeDown" class="btn" title="500減らす" style="padding: 0.25rem 0.75rem; font-weight: bold; background-color: #ef4444; color: white; border-color: #ef4444;">
                            －
                        </button>
                        <button id="chunkSizeUp" class="btn" title="500増やす" style="padding: 0.25rem 0.75rem; font-weight: bold; background-color: #10b981; color: white; border-color: #10b981;">
                            ＋
                        </button>
                    </div>
                </div>

                <div class="control-group" style="flex: 1;">
                    <label class="label">&nbsp;</label>
                    <div id="progressInfo" style="display: none;">
                        <span id="statusMessage" style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">処理中...</span>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="control-group file-select-group" style="margin-left: auto;">
                    <input type="file" id="fileInput" class="hidden-file-input" accept=".epub,.pdf,.txt,.md">
                    <button type="button" id="fileInputButton" class="btn btn-default">
                        <span class="btn-text">ファイルを選択 (EPUB/PDF)</span>
                    </button>
                </div>
            </div>

            <!-- Editor Container -->
            <div class="editor-container">
                <!-- Input Panel -->
                <div class="editor-panel">
                    <div class="panel-header">
                        <span class="panel-title">入力 (Markdown)</span>
                        <span class="panel-info" id="inputCharCount">0文字</span>
                    </div>
                    <textarea id="inputText" class="textarea" placeholder="翻訳したいMarkdownテキストを入力してください...

# 見出し1
## 見出し2

- リスト項目1
- リスト項目2

```javascript
// コードブロック
console.log('Hello World');
```"></textarea>
                </div>

                <!-- Output Panel -->
                <div class="editor-panel" style="position: relative;">
                    <div class="panel-header">
                        <div class="tabs-list">
                            <button class="tabs-trigger" data-state="active" data-tab="text">Markdown</button>
                            <button class="tabs-trigger" data-tab="preview">HTML</button>
                        </div>
                        <span class="panel-info" id="outputCharCount">0文字</span>
                    </div>
                    
                    <div class="tabs">
                        <div class="tabs-content" data-state="active" data-content="text">
                            <textarea id="outputText" class="textarea" placeholder="翻訳結果がここに表示されます..."></textarea>
                        </div>
                        
                        <div class="tabs-content" data-content="preview">
                            <div class="preview-container" id="previewContainer">
                                <div class="markdown-body" id="markdownPreview"></div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </main>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">エクスポート形式を選択</h2>
            </div>
            <div class="modal-body">
                <div class="export-section">
                    <h3 class="export-section-title">ファイル形式</h3>
                    <div class="export-options">
                        <label class="export-option">
                            <input type="radio" name="fileFormat" value="html" checked>
                            <div class="export-option-content">
                                <div class="export-option-title">HTML</div>
                                <div class="export-option-description">ブラウザで表示可能な形式</div>
                            </div>
                        </label>
                        <label class="export-option">
                            <input type="radio" name="fileFormat" value="markdown">
                            <div class="export-option-content">
                                <div class="export-option-title">Markdown</div>
                                <div class="export-option-description">テキストエディタで編集可能な形式</div>
                            </div>
                        </label>
                    </div>
                </div>
                <div class="export-section">
                    <h3 class="export-section-title">出力内容</h3>
                    <div class="export-options">
                        <label class="export-option">
                            <input type="radio" name="exportType" value="translation-only" checked>
                            <div class="export-option-content">
                                <div class="export-option-title">翻訳のみ</div>
                                <div class="export-option-description">翻訳結果のみを出力します</div>
                            </div>
                        </label>
                        <label class="export-option">
                            <input type="radio" name="exportType" value="side-by-side">
                            <div class="export-option-content">
                                <div class="export-option-title">原文・翻訳対照</div>
                                <div class="export-option-description">原文と翻訳を並べて表示します</div>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelExport">キャンセル</button>
                <button class="btn btn-primary" id="confirmExport">エクスポート</button>
            </div>
        </div>
    </div>

    <!-- External JavaScript -->
    <script src="prompts.js?v=1756175428"></script>
    <!-- Development: Use bundled version -->
    <script src="translator.bundle.js?v=20250901"></script>
    <!-- Production: Use minified bundle (uncomment for production) -->
    <!-- <script src="translator.min.js"></script> -->
    
</body>
</html>
